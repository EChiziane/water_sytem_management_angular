<div class="content-wrapper">

  <!-- ===== Breadcrumb ===== -->
  <nz-breadcrumb class="page-breadcrumb">
    <nz-breadcrumb-item>
      <a routerLink="/app">Home</a>
    </nz-breadcrumb-item>

    <nz-breadcrumb-item>
      <a routerLink="/app/customers">Customers</a>
    </nz-breadcrumb-item>

    <nz-breadcrumb-item>
      Lista dos Clientes
    </nz-breadcrumb-item>
  </nz-breadcrumb>

  <!-- ===== Page Header ===== -->
  <div class="page-header">
    <p>Lista dos Clientes</p>

    <span class="back-arrow" (click)="onBack()">
      <nz-icon nzType="arrow-left" nzTheme="outline"></nz-icon>
    </span>
  </div>

  <!-- ===== Summary Section ===== -->
  <div class="summary-section">
    <div class="summary-background">
      <div nz-row [nzGutter]="8">

        <!-- Total Customers -->
        <div nz-col [nzSpan]="8">
          <nz-card nzSize="small">
            <div class="summary-card">
              <div class="icon-wrapper total">
                <nz-icon nzType="team" nzTheme="outline"></nz-icon>
              </div>
              <div class="summary-content">
                <span class="title">Total Customers</span>
                <p>{{ totalCustomers }}</p>
              </div>
            </div>
          </nz-card>
        </div>

        <!-- Debtors -->
        <div nz-col [nzSpan]="8">
          <nz-card nzSize="small">
            <div class="summary-card">
              <div class="icon-wrapper inactive">
                <nz-icon nzType="warning" nzTheme="outline"></nz-icon>
              </div>
              <div class="summary-content">
                <span class="title">Clientes Devedores</span>
                <p>{{ debtorsCustomers }}</p>
              </div>
            </div>
          </nz-card>
        </div>

        <!-- Regular -->
        <div nz-col [nzSpan]="8">
          <nz-card nzSize="small">
            <div class="summary-card">
              <div class="icon-wrapper active">
                <nz-icon nzType="check-circle" nzTheme="outline"></nz-icon>
              </div>
              <div class="summary-content">
                <span class="title">Clientes Regulares</span>
                <p>{{ regularCustomers }}</p>
              </div>
            </div>
          </nz-card>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== Filters Panel ===== -->
  <div class="filters-panel">
    <input
      nz-input
      type="text"
      placeholder="Search name"
      [(ngModel)]="searchValue"
      (ngModelChange)="search()"
    />

    <button nz-button nzType="primary" (click)="openCustomerDrawer()">
      <nz-icon nzType="user-add" nzTheme="outline"></nz-icon>
      Novo Customer
    </button>
  </div>

  <!-- ===== Table ===== -->
  <div class="table-wrapper">
    <div class="table-scroll">

      <nz-spin
        nzSize="large"
        nzTip="A carregar Customer..."
        [nzSpinning]="isLoading">

        <nz-table
          #nzTable
          nzTableLayout="fixed"
          [nzData]="listOfDisplayData"
          [nzScroll]="{ x: '1150px', y: '340px' }">

          <!-- ===== Table Head ===== -->
          <thead>
          <tr>
            <th nzCustomFilter>
              Name
              <nz-filter-trigger
                [(nzVisible)]="visible"
                [nzActive]="searchValue.length > 0"
                [nzDropdownMenu]="menu">
                <nz-icon nzType="search"></nz-icon>
              </nz-filter-trigger>
            </th>
            <th>Valve</th>
            <th>Contact</th>
            <th>Debt Status</th>
            <th>Months</th>
            <th>Monthly Fee</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
          </thead>

          <!-- ===== Table Body ===== -->
          <tbody>
          <tr *ngFor="let data of nzTable.data">
            <td>{{ data.name }}</td>
            <td>{{ data.valve }}</td>
            <td>{{ data.contact }}</td>

            <td>
              <nz-tag [nzColor]="data.monthsInDebt > 0 ? 'red' : 'green'">
                {{ data.monthsInDebt > 0 ? 'Em DÃ­vida' : 'Em Dia' }}
              </nz-tag>
            </td>
            <td>{{ data.monthsInDebt }}</td>

            <td>{{ data.monthlyFee | number:'1.2-2' }} Mts</td>

            <td>
              <nz-tag [nzColor]="data.status === 'ATIVO' ? 'green' : 'red'">
                {{ data.status }}
              </nz-tag>
            </td>

            <td>
              <button nz-button nzType="link" nzSize="small"
                      (click)="viewCustomer(data)"
                      [routerLink]="['/app/customer-detail', data.id]">
                <nz-icon nzType="eye" nzTheme="outline"></nz-icon>
              </button>

              <button nz-button nzType="link" nzSize="small"
                      (click)="editCustomer(data)">
                <nz-icon nzType="edit" nzTheme="outline"></nz-icon>
              </button>

              <button nz-button nzType="link" nzSize="small" nzDanger
                      (click)="deleteCustomer(data)">
                <nz-icon nzType="delete" nzTheme="outline"></nz-icon>
              </button>
            </td>
          </tr>
          </tbody>

        </nz-table>
      </nz-spin>

      <!-- ===== Filter Dropdown ===== -->
      <nz-dropdown-menu #menu="nzDropdownMenu">
        <div class="ant-table-filter-dropdown">
          <div class="search-box">
            <input
              nz-input
              type="text"
              placeholder="Search name"
              [(ngModel)]="searchValue"
              (ngModelChange)="search()"
            />

            <button nz-button nzSize="small" nzType="primary" (click)="search()">Search</button>
            <button nz-button nzSize="small" (click)="reset()">Reset</button>
          </div>
        </div>
      </nz-dropdown-menu>

    </div>
  </div>
</div>
