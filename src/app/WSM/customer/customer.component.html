<div class="content-wrapper">

  <!-- ===== Page Header ===== -->
  <div class="page-header">
    <p>Lista dos Clientes</p>

    <span (click)="onBack()" class="back-arrow">
      <nz-icon nzTheme="outline" nzType="arrow-left"></nz-icon>
    </span>
  </div>

  <!-- ===== Summary Section ===== -->
  <div class="summary-section">
    <div class="summary-background">
      <div [nzGutter]="8" nz-row>

        <!-- Total Customers -->
        <div [nzSpan]="8" nz-col>
          <nz-card nzSize="small" nzTitle="Total Customers">
            <p>{{ totalCustomers }}</p>
          </nz-card>
        </div>

        <!-- Active Customers -->
        <div [nzSpan]="8" nz-col>
          <nz-card nzSize="small" nzTitle="Active Customers">
            <p>{{ activeCustomers }}</p>
          </nz-card>
        </div>

        <!-- Inactive Customers -->
        <div [nzSpan]="8" nz-col>
          <nz-card nzSize="small" nzTitle="Inactive Customers">
            <p>{{ inactiveCustomers }}</p>
          </nz-card>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== Filters Panel ===== -->
  <div class="filters-panel">
    <input
      (ngModelChange)="search()"
      [(ngModel)]="searchValue"
      nz-input
      placeholder="Search name"
      type="text"
    />

    <button (click)="openCustomerDrawer()" nz-button nzType="primary">Novo Customer</button>
  </div>

  <!-- ===== Table Wrapper ===== -->
  <div class="table-wrapper">
    <div class="table-scroll">
      <nz-spin
        [nzSpinning]="isLoading"
        nzSize="large"
        nzTip="A carregar Customer...">

        <!-- ===== Customers Table ===== -->
        <nz-table
          #nzTable
          [nzData]="listOfDisplayData"
          [nzScroll]="{ x: '1150px', y: '340px' }"
          nzTableLayout="fixed">

          <thead>
          <tr>

            <!-- Name Column with Filter -->
            <th nzCustomFilter>
              Name
              <nz-filter-trigger
                [(nzVisible)]="visible"
                [nzActive]="searchValue.length > 0"
                [nzDropdownMenu]="menu">
                <nz-icon nzType="search"></nz-icon>
              </nz-filter-trigger>
            </th>
            <th>Months</th>
            <th>Valve</th>
            <th>Contact</th>
            <th>Monthly Fee</th>
            <th>Status</th>


            <th>Actions</th>

          </tr>
          </thead>

          <tbody>
          <tr *ngFor="let data of nzTable.data">

            <td>{{ data.name }}</td>
            <td>{{ data.monthsInDebt }}</td>

            <td>{{ data.valve }}</td>
            <td>{{ data.contact }}</td>
            <td>{{ data.monthlyFee | number:'1.2-2' }} Mts</td>

            <td>
              <nz-tag [nzColor]="data.status === 'ATIVO' ? 'green' : 'red'">
                {{ data.status }}
              </nz-tag>
            </td>


            <td>
              <!-- View -->
              <button
                (click)="viewCustomer(data)"
                [routerLink]="['/app/customer-detail', data.id]"
                nz-button
                nzSize="small"
                nzType="link">
                <nz-icon nzTheme="outline" nzType="eye"></nz-icon>
              </button>

              <!-- Edit -->
              <button
                (click)="editCustomer(data)"
                nz-button
                nzSize="small"
                nzType="link">
                <nz-icon nzTheme="outline" nzType="edit"></nz-icon>
              </button>

              <!-- Delete -->
              <button
                (click)="deleteCustomer(data)"
                nz-button
                nzDanger
                nzSize="small"
                nzType="link">
                <nz-icon nzTheme="outline" nzType="delete"></nz-icon>
              </button>
            </td>

          </tr>
          </tbody>

        </nz-table>
      </nz-spin>

      <!-- ===== Table Filter Dropdown ===== -->
      <nz-dropdown-menu #menu="nzDropdownMenu">
        <div class="ant-table-filter-dropdown">
          <div class="search-box">

            <input
              (ngModelChange)="search()"
              [(ngModel)]="searchValue"
              nz-input
              placeholder="Search name"
              type="text"
            />

            <button (click)="search()" nz-button nzSize="small" nzType="primary">Search</button>
            <button (click)="reset()" nz-button nzSize="small">Reset</button>

          </div>
        </div>
      </nz-dropdown-menu>

    </div>
  </div>
</div>

<!-- ====================================================== -->
<!-- ============== CUSTOMER DRAWER ======================== -->
<!-- ====================================================== -->

<nz-drawer
  (nzOnClose)="closeCustomerDrawer()"
  [nzBodyStyle]="{ overflow: 'auto' }"
  [nzFooter]="customerDrawerFooter"
  [nzMaskClosable]="false"
  [nzTitle]="customerDrawerTitle"
  [nzVisible]="isCustomerDrawerVisible"
  [nzWidth]="drawerWidth">

  <form
    *nzDrawerContent
    [formGroup]="customerForm"
    class="drawer-form"
    nz-form>

    <!-- ===== Section: Basic Information ===== -->
    <div class="drawer-section">
      <h3 class="section-title">Basic Information</h3>

      <div [nzGutter]="16" nz-row>

        <!-- Name -->
        <div nz-col nzXs="24" nzSm="24" nzMd="12">
          <nz-form-item>
            <nz-form-label>Nome</nz-form-label>
            <nz-form-control>
              <input formControlName="name" nz-input placeholder="Digite o nome do cliente"/>
            </nz-form-control>
          </nz-form-item>
        </div>

        <!-- Contact -->
        <div nz-col nzXs="24" nzSm="24" nzMd="12">
          <nz-form-item>
            <nz-form-label>Contato</nz-form-label>
            <nz-form-control>
              <nz-input-group nzAddOnBefore="+258">
                <input
                  formControlName="contact"
                  nz-input
                  placeholder="Digite o contato"/>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>

      </div>

      <div [nzGutter]="16" nz-row>

        <!-- Address -->
        <div nz-col nzXs="24" nzSm="24" nzMd="12">
          <nz-form-item>
            <nz-form-label>Endereço</nz-form-label>
            <nz-form-control>
              <input formControlName="address" nz-input placeholder="Digite o endereço"/>
            </nz-form-control>
          </nz-form-item>
        </div>

        <!-- Status -->
        <div nz-col nzXs="24" nzSm="24" nzMd="12">
          <nz-form-item>
            <nz-form-label>Status</nz-form-label>
            <nz-form-control>
              <nz-select formControlName="status" nzPlaceHolder="Selecione o status">
                <nz-option nzLabel="ATIVO" nzValue="ATIVO"></nz-option>
                <nz-option nzLabel="INATIVO" nzValue="INATIVO"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>

      </div>

      <div [nzGutter]="16" nz-row>

        <!-- Valve -->
        <div nz-col nzXs="24" nzSm="24" nzMd="12">
          <nz-form-item>
            <nz-form-label>Valve</nz-form-label>
            <nz-form-control>
              <nz-input-group nzAddOnBefore="MZN">
                <input
                  formControlName="valve"
                  nz-input
                  placeholder="Digite a válvula"
                  type="number"/>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>

        <!-- Months in Debt -->
        <div nz-col nzXs="24" nzSm="24" nzMd="12">
          <nz-form-item>
            <nz-form-label>Meses em Dívida</nz-form-label>
            <nz-form-control>
              <input
                formControlName="monthsInDebt"
                nz-input
                placeholder="Digite os meses"
                type="number"/>
            </nz-form-control>
          </nz-form-item>
        </div>

        <!-- Monthly Fee -->
        <div nz-col nzXs="24" nzSm="24" nzMd="12">
          <nz-form-item>
            <nz-form-label>Monthly Fee</nz-form-label>
            <nz-form-control>
              <nz-input-group nzAddOnBefore="MZN">
                <input
                  formControlName="monthlyFee"
                  nz-input
                  placeholder="750"
                  type="number"/>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>


      </div>

    </div>
  </form>

  <!-- Drawer Footer -->
  <ng-template #customerDrawerFooter>
    <div class="drawer-footer">
      <button (click)="closeCustomerDrawer()"
              class="btn-cancel"
              nz-button nzType=
                "default">Cancelar
      </button>

      <button (click)="createCustomer()" [disabled]="customerForm.invalid" class="btn-save"
              nz-button
              nzType="primary">
        {{ isEditMode ? 'Salvar' : 'Criar' }}
      </button>
    </div>
  </ng-template>

</nz-drawer>


