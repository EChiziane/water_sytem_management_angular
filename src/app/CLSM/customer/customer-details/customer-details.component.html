<div class="customer-details-container">

  <!-- ===== Page Header ===== -->
  <div class="page-header">
    <p>Detalhes do Cliente</p>

    <span class="back-arrow" (click)="onBack()">
      <nz-icon nzType="arrow-left" nzTheme="outline" />

  </span>
  </div>

  <div class="info-section">

    <!-- ==== Informações do Cliente ==== -->
    <section class="section">
      <h3 class="section-title">Informações do Cliente</h3>

      <div class="info-grid">
        <div class="item"><strong>Nome:</strong> {{ customer.name }}</div>
        <div class="item"><strong>Contato:</strong> {{ customer.contact }}</div>
        <div class="item"><strong>Endereço:</strong> {{ customer.address }}</div>

        <div class="item">
          <strong>Status:</strong>
          <nz-tag [nzColor]="customer.status === 'ATIVO' ? 'green' : 'volcano'">
            {{ customer.status }}
          </nz-tag>
        </div>

        <div class="item"><strong>Valor:</strong> {{ customer.valve }} MT</div>
        <div class="item">
          <strong>Criação:</strong> {{ customer.createdAt | date: 'dd/MM/yyyy HH:mm' }}
        </div>
      </div>
    </section>

    <!-- ==== Dívidas ==== -->
    <section class="section">
      <h3 class="section-title">Dívidas</h3>

      <div class="debt-grid">

        <div class="debt-box">
          <p class="debt-label">Meses em Dívida</p>
          <p class="debt-number">{{ customer.monthsInDebt }}</p>
        </div>

        <div class="debt-box">
          <p class="debt-label">Meses Correspondentes</p>

          <p class="debt-months-inline">
          <span *ngFor="let m of debtMonths; let last = last">
            {{ m }}<span *ngIf="!last">, </span><span *ngIf="last">.</span>
          </span>
          </p>
        </div>

      </div>
    </section>

  </div>

  <div class="filters-panel">
    <input (ngModelChange)="search()"
           [(ngModel)]="searchValue"
           nz-input
           placeholder="Search name"
           type="text"/>
    <button (click)="openPaymentDrawer()" nz-button nzType="primary">Novo Payment</button>
  </div>

  <!-- ===== Table Section ===== -->
  <div class="table-wrapper">
    <div class="table-scroll">
      <nz-spin
        [nzSpinning]="isLoading"
        nzSize="large"
        nzTip="A carregar Payments...">


        <nz-card class="payment-card" nzTitle="Histórico de Pagamentos">
          <nz-table
            #nzTable
            [nzData]="listOfDisplayData"
            nzTableLayout="fixed"
            [nzScroll]="{ x: '1150px', y: '200px' }"
          >
            <thead>
            <tr>
              <th>Cliente</th>
              <th>Montante</th>
              <th>Mês de Referência</th>
              <th>Método</th>
              <th>Confirmado</th>
              <th>Data</th>
              <th>Ações</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let data of nzTable.data">
              <td>{{ data.customerName }}</td>
              <td>{{ data.amount }}</td>
              <td>{{ data.referenceMonth }}</td>
              <td>{{ data.paymentMethod }}</td>
              <td>
                <nz-tag [nzColor]="data.confirmed ? 'green' : 'red'">
                  {{ data.confirmed ? 'Sim' : 'Não' }}
                </nz-tag>
              </td>
              <td>{{ data.paymentDate | date: 'dd/MM/yyyy HH:mm' }}</td>

              <td class="action-buttons">
                <button nz-button nzType="link" nzSize="small"
                        [routerLink]="['/payment-detail',data.id]">
                  <nz-icon nzType="eye"></nz-icon>
                </button>

                <button nz-button nzType="link" nzSize="small"
                        (click)="printPayment(data)">
                  <nz-icon nzType="printer"></nz-icon>
                </button>

                <button nz-button nzType="link" nzDanger nzSize="small"
                        (click)="deletePayment(data)">
                  <nz-icon nzType="delete"></nz-icon>
                </button>
              </td>
            </tr>
            </tbody>
          </nz-table>
        </nz-card>

      </nz-spin>



    </div>
  </div>




</div>
<nz-drawer
  [nzVisible]="isPaymentDrawerVisible"
  (nzOnClose)="closePaymentDrawer()"
  [nzTitle]="paymentDrawerTitle"
  [nzWidth]="520"
  [nzMaskClosable]="false"
  [nzFooter]="paymentDrawerFooter">

  <form *nzDrawerContent [formGroup]="paymentForm" class="drawer-form" nz-form>

    <div class="drawer-section">
      <h3 class="section-title">Informações do Pagamento</h3>

      <div nz-row nzGutter="16">
        <div nz-col nzSpan="12">
          <nz-form-item>
            <nz-form-label>Montante</nz-form-label>
            <nz-form-control>
              <nz-input-group nzAddOnBefore="MZN">
                <input nz-input type="number" formControlName="amount" placeholder="Digite o valor"/>
              </nz-input-group>
            </nz-form-control>
          </nz-form-item>
        </div>

        <div nz-col nzSpan="12">
          <nz-form-item>
            <nz-form-label>Mês de Referência</nz-form-label>
            <nz-form-control>
              <nz-select formControlName="referenceMonth" nzPlaceHolder="Selecione o mês">
                <nz-option *ngFor="let m of debtMonths" [nzLabel]="m" [nzValue]="m"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>

      <div nz-row nzGutter="16">
        <div nz-col nzSpan="24">
          <nz-form-item>
            <nz-form-label>Método de Pagamento</nz-form-label>
            <nz-form-control>
              <nz-select formControlName="paymentMethod" nzPlaceHolder="Selecione o método">
                <nz-option nzLabel="M-Pesa" nzValue="MPESA"></nz-option>
                <nz-option nzLabel="Depósito Bancário" nzValue="BANK"></nz-option>
                <nz-option nzLabel="Dinheiro" nzValue="CASH"></nz-option>
              </nz-select>
            </nz-form-control>
          </nz-form-item>
        </div>
      </div>
    </div>

  </form>

  <ng-template #paymentDrawerFooter>
    <div class="drawer-footer">
      <button nz-button (click)="closePaymentDrawer()">Cancelar</button>
      <button nz-button nzType="primary" (click)="savePayment()">Confirmar Pagamento</button>
    </div>
  </ng-template>

</nz-drawer>
