<div class="content-wrapper">

  <!-- ===== Page Header ===== -->
  <div class="page-header">
    <p>Lista de Clientes</p>
  </div>

  <!-- ===== Filters Section ===== -->
  <div class="filters-panel">
    <input
      (ngModelChange)="search()"
      [(ngModel)]="searchValue"
      nz-input
      placeholder="Procurar..."
      type="text"
    />
    <button (click)="openDrawer()" nz-button nzType="primary">Novo Cliente</button>
  </div>

  <!-- ===== Table Section ===== -->
  <div class="table-wrapper">
    <div class="table-scroll">
      <nz-spin
        [nzSpinning]="isLoading"
        nzSize="large"
        nzTip="A carregar clientes..."
      >
        <nz-table
          #customerTable
          [nzData]="customers"
          [nzScroll]="{ x: '900px', y: '500px' }"
          nzTableLayout="fixed"
        >
          <thead>
          <tr>
            <th>Nome</th>
            <th>Código</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Morada</th>
            <th>Ações</th>
          </tr>
          </thead>

          <tbody>
          <tr *ngFor="let customer of customerTable.data">

            <!-- Editable Name -->
            <td>
              <ng-container *ngIf="editingCustomer?.id === customer.id && editingField === 'name'; else viewName">
                <input
                  (blur)="saveInlineEdit(customer, 'name')"
                  (keyup.enter)="saveInlineEdit(customer, 'name')"
                  [(ngModel)]="editingCustomer!.name"
                  nz-input
                />
              </ng-container>
              <ng-template #viewName>
                  <span
                    (click)="startInlineEdit(customer, 'name')"
                    class="editable-cell"
                  >
                    {{ customer.name }}
                  </span>
              </ng-template>
            </td>

            <!-- Editable Code -->
            <td>
              <ng-container
                *ngIf="editingCustomer?.id === customer.id && editingField === 'customerCode'; else viewCode">
                <input
                  (blur)="saveInlineEdit(customer, 'customerCode')"
                  (keyup.enter)="saveInlineEdit(customer, 'customerCode')"
                  [(ngModel)]="editingCustomer!.customerCode"
                  nz-input
                />
              </ng-container>
              <ng-template #viewCode>
                  <span
                    (click)="startInlineEdit(customer, 'customerCode')"
                    class="editable-cell"
                  >
                    {{ customer.customerCode }}
                  </span>
              </ng-template>
            </td>

            <!-- Phone -->
            <td>{{ customer.phoneNumber }}</td>

            <!-- Email -->
            <td>{{ customer.emailAddress }}</td>

            <!-- Address -->
            <td>{{ customer.streetAddress }}, {{ customer.city }}, {{ customer.zipCode }}</td>

            <!-- Actions -->
            <td class="actions">
              <button
                (click)="editCustomer(customer)"
                nz-button
                nzSize="small"
                nzType="link"
              >
                <nz-icon nzTheme="outline" nzType="edit"></nz-icon>
              </button>

              <button
                (click)="deleteCustomer(customer)"
                nz-button
                nzDanger
                nzSize="small"
                nzType="link"
              >
                <nz-icon nzTheme="outline" nzType="delete"></nz-icon>
              </button>
            </td>

          </tr>
          </tbody>
        </nz-table>
      </nz-spin>
    </div>
  </div>
</div>

<!-- ===== Customer Drawer ===== -->
<nz-drawer
  (nzOnClose)="closeDrawer()"
  [nzFooter]="drawerFooter"
  [nzTitle]="drawerTitle"
  [nzVisible]="isDrawerVisible"
  [nzWidth]="480"
>
  <form *nzDrawerContent [formGroup]="customerForm" nz-form>
    <div class="drawer-section">

      <!-- Name -->
      <nz-form-item>
        <nz-form-label nzRequired>Nome</nz-form-label>
        <nz-form-control>
          <input formControlName="name" nz-input placeholder="Nome do cliente"/>
        </nz-form-control>
      </nz-form-item>

      <!-- Phone -->
      <nz-form-item>
        <nz-form-label nzRequired>Telefone</nz-form-label>
        <nz-form-control>
          <nz-input-group nzAddOnBefore="+258">
            <input formControlName="phoneNumber" nz-input placeholder="Número de telefone"/>
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>

      <!-- Code -->
      <nz-form-item>
        <nz-form-label>Código</nz-form-label>
        <nz-form-control>
          <input formControlName="customerCode" nz-input placeholder="Ex. CUST001"/>
        </nz-form-control>
      </nz-form-item>

      <!-- NUIT -->
      <nz-form-item>
        <nz-form-label>NUIT</nz-form-label>
        <nz-form-control>
          <input formControlName="nuitNumber" nz-input placeholder="Ex. 123456789"/>
        </nz-form-control>
      </nz-form-item>

      <!-- Address -->
      <nz-form-item>
        <nz-form-label>Morada</nz-form-label>
        <nz-form-control>
          <input formControlName="streetAddress" nz-input placeholder="Ex. Rua Principal"/>
        </nz-form-control>
      </nz-form-item>

      <!-- City -->
      <nz-form-item>
        <nz-form-label>Cidade</nz-form-label>
        <nz-form-control>
          <input formControlName="city" nz-input placeholder="Ex. Maputo Cidade"/>
        </nz-form-control>
      </nz-form-item>

      <!-- Zip Code -->
      <nz-form-item>
        <nz-form-label>Zip Code</nz-form-label>
        <nz-form-control>
          <input formControlName="zipCode" nz-input placeholder="Ex. 12345"/>
        </nz-form-control>
      </nz-form-item>

      <!-- Email -->
      <nz-form-item>
        <nz-form-label>Email</nz-form-label>
        <nz-form-control>
          <input formControlName="emailAddress" nz-input placeholder="Ex. customer@gmail.com"/>
        </nz-form-control>
      </nz-form-item>

    </div>
  </form>

  <!-- ===== Drawer Footer ===== -->
  <ng-template #drawerFooter>
    <div class="drawer-footer">
      <button
        (click)="closeDrawer()"
        class="btn-cancel"
        nz-button
        nzType="default"
      >
        Cancelar
      </button>

      <button
        (click)="submitCustomer()"
        [disabled]="!customerForm.get('name')?.valid || !customerForm.get('phoneNumber')?.valid"
        class="btn-save"
        nz-button
        nzType="primary"
      >
        Salvar
      </button>
    </div>
  </ng-template>
</nz-drawer>
