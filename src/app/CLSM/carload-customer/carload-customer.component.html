<div class="content-wrapper">
  <!-- ===== Section: Page Header ===== -->
  <div class="page-header">
    <p>Lista de Clientes</p>
  </div>

  <!-- ===== Section: Filters ===== -->
  <div class="filters-panel">
    <input
      (ngModelChange)="search()"
      [(ngModel)]="searchValue"
      nz-input
      placeholder="Procurar..."
      type="text"
    />
    <button (click)="openDrawer()" nz-button nzType="primary">Novo Cliente</button>
  </div>

  <!-- ===== Section: Table ===== -->
  <div class="table-wrapper">
    <div class="table-scroll">
      <nz-spin [nzSpinning]="isLoading" nzSize="large" nzTip="A carregar clientes...">
        <nz-table
          #customerTable
          [nzData]="customers"
          [nzScroll]="{ x: '900px', y: '500px' }"
          nzTableLayout="fixed"
        >
          <thead>
          <tr>
            <th>Nome</th>
            <th>Código</th>
            <th>Telefone</th>
            <th>Email</th>
            <th>Morada</th>
            <th>Ações</th>
          </tr>
          </thead>
          <tbody>
          <tr *ngFor="let customer of customerTable.data">
            <!-- Editable Name -->
            <td>
              <ng-container *ngIf="editingCustomer?.id === customer.id && editingField === 'name'; else viewName">
                <input
                  (blur)="saveInlineEdit(customer, 'name')"
                  (keyup.enter)="saveInlineEdit(customer, 'name')"
                  [(ngModel)]="editingCustomer!.name"
                  nz-input
                />
              </ng-container>
              <ng-template #viewName>
                  <span (click)="startInlineEdit(customer, 'name')" class="editable-cell">
                    {{ customer.name }}
                  </span>
              </ng-template>
            </td>

            <!-- Editable Customer Code -->
            <td>
              <ng-container *ngIf="editingCustomer?.id === customer.id && editingField === 'customerCode'; else viewCode">
                <input
                  (blur)="saveInlineEdit(customer, 'customerCode')"
                  (keyup.enter)="saveInlineEdit(customer, 'customerCode')"
                  [(ngModel)]="editingCustomer!.customerCode"
                  nz-input
                />
              </ng-container>
              <ng-template #viewCode>
                  <span (click)="startInlineEdit(customer, 'customerCode')" class="editable-cell">
                    {{ customer.customerCode }}
                  </span>
              </ng-template>
            </td>

            <!-- Phone -->
            <td>{{ customer.phoneNumber }}</td>

            <!-- Email -->
            <td>{{ customer.emailAddress }}</td>

            <!-- Street + City + Zip -->
            <td>{{ customer.streetAddress }}, {{ customer.city }}, {{ customer.zipCode }}</td>


            <!-- Actions -->
            <td>
              <button (click)="editCustomer(customer)" nz-button nzSize="small" nzType="link">
                <nz-icon nzTheme="outline" nzType="edit"></nz-icon>
              </button>
              <button (click)="deleteCustomer(customer)" nz-button nzDanger nzSize="small" nzType="link">
                <nz-icon nzTheme="outline" nzType="delete"></nz-icon>
              </button>
            </td>
          </tr>
          </tbody>
        </nz-table>
      </nz-spin>
    </div>
  </div>
</div>

<!-- ===== Customer Drawer ===== -->
<nz-drawer
  (nzOnClose)="closeDrawer()"
  [nzFooter]="drawerFooter"
  [nzTitle]="drawerTitle"
  [nzVisible]="isDrawerVisible"
  [nzWidth]="480"
>
  <form *nzDrawerContent [formGroup]="customerForm" nz-form>
    <div class="drawer-section">
      <nz-form-item>
        <nz-form-label nzRequired>Nome</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="name" placeholder="Nome do cliente"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired>Telefone</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="phoneNumber" placeholder="Número de Telefone"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Código</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="customerCode" placeholder="Ex. CUST001"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>NUIT</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="nuitNumber" placeholder="Ex. 123456789"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Morada</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="streetAddress" placeholder="Ex. Rua Principal"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Cidade</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="city" placeholder="Ex. Maputo Cidade"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Zip Code</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="zipCode" placeholder="Ex. 12345"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label>Email</nz-form-label>
        <nz-form-control>
          <input nz-input formControlName="emailAddress" placeholder="Ex. customer@gmail.com"/>
        </nz-form-control>
      </nz-form-item>
    </div>
  </form>

  <ng-template #drawerFooter>
    <button (click)="closeDrawer()" nz-button>Cancelar</button>
    <button (click)="submitCustomer()" [disabled]="!customerForm.get('name')?.valid || !customerForm.get('phoneNumber')?.valid" nz-button nzType="primary">Salvar</button>
  </ng-template>
</nz-drawer>


