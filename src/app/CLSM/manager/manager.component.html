<div class="content-wrapper">

  <!-- ===== Section: Page Header ===== -->
  <div class="page-header">
    <p>Lista de Managers</p>
  </div>

  <!-- ===== Section: Summary Cards ===== -->
  <div class="summary-section">
    <div class="summary-background">
      <div [nzGutter]="8" nz-row>

        <div [nzSpan]="8" nz-col>
          <nz-card nzTitle="Total Managers">
            <p>{{ totalManagers | number }}</p>
          </nz-card>
        </div>

        <div [nzSpan]="8" nz-col>
          <nz-card nzTitle="Ativos">
            <p>{{ totalActiveManagers | number }}</p>
          </nz-card>
        </div>

        <div [nzSpan]="8" nz-col>
          <nz-card nzTitle="Inativos">
            <p>{{ totalInActiveManagers | number }}</p>
          </nz-card>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== Section: Filters ===== -->
  <div class="filters-panel">
    <input
      (ngModelChange)="search()"
      [(ngModel)]="searchValue"
      nz-input
      placeholder="Search..."
      type="text"
    />
    <button (click)="openManagerDrawer()" nz-button nzType="primary">Novo Manager</button>
    <button (click)="filterByStatus('ACTIVO')" nz-button nzType="default">Ativos</button>
    <button (click)="filterByStatus('INACTIVO')" nz-button nzType="default">Inativos</button>
    <button (click)="showAll()" nz-button nzType="default">Todos</button>
  </div>

  <!-- ===== Section: Table ===== -->
  <div class="table-wrapper">
    <div class="table-scroll">
      <nz-spin [nzSpinning]="isLoading" nzSize="large" nzTip="A carregar managers...">
        <nz-table
          #nzTable
          [nzData]="listOfDisplayData"
          [nzScroll]="{ x: '800px', y: '280px' }"
          nzTableLayout="fixed"
        >
          <thead>
          <tr>
            <th>Nome</th>
            <th>Contacto</th>
            <th>Morada</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
          </thead>

          <tbody>
          <tr *ngFor="let manager of nzTable.data">

            <!-- Editable: Name -->
            <td>
              <ng-container
                *ngIf="currentEditingManagerId === manager.id && editingField === 'name'; else viewName"
              >
                <input
                  (blur)="saveInlineEdit(manager, 'name')"
                  (keyup.enter)="saveInlineEdit(manager, 'name')"
                  [(ngModel)]="manager.name"
                  nz-input
                />
              </ng-container>
              <ng-template #viewName>
                  <span (click)="startInlineEdit(manager, 'name')" class="editable-cell">
                    {{ manager.name }}
                  </span>
              </ng-template>
            </td>

            <!-- Editable: Contact -->
            <td>
              <ng-container
                *ngIf="currentEditingManagerId === manager.id && editingField === 'contact'; else viewContact"
              >
                <input
                  (blur)="saveInlineEdit(manager, 'contact')"
                  (keyup.enter)="saveInlineEdit(manager, 'contact')"
                  [(ngModel)]="manager.contact"
                  nz-input
                />
              </ng-container>
              <ng-template #viewContact>
                  <span (click)="startInlineEdit(manager, 'contact')" class="editable-cell">
                    {{ manager.contact }}
                  </span>
              </ng-template>
            </td>

            <!-- Editable: Address -->
            <td>
              <ng-container
                *ngIf="currentEditingManagerId === manager.id && editingField === 'address'; else viewAddress"
              >
                <input
                  (blur)="saveInlineEdit(manager, 'address')"
                  (keyup.enter)="saveInlineEdit(manager, 'address')"
                  [(ngModel)]="manager.address"
                  nz-input
                />
              </ng-container>
              <ng-template #viewAddress>
                  <span (click)="startInlineEdit(manager, 'address')" class="editable-cell">
                    {{ manager.address }}
                  </span>
              </ng-template>
            </td>

            <!-- Status -->
            <td>
              <button
                [nzDropdownMenu]="menu"
                nz-button
                nz-dropdown
                nzTrigger="click">
                <nz-tag [nzColor]="manager.status === 'ACTIVO' ? 'green' : 'red'">
                  {{ manager.status }}
                </nz-tag>
              </button>

              <nz-dropdown-menu #menu="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="updateStatusManager(manager, 'ACTIVO')" nz-menu-item>
                    <span class="status-option status-ativo">Ativo</span>
                  </li>
                  <li (click)="updateStatusManager(manager, 'INACTIVO')" nz-menu-item>
                    <span class="status-option status-inativo">Inativo</span>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </td>


            <!-- Actions -->
            <td>
              <button (click)="editManager(manager)" nz-button nzSize="small" nzType="link">
                <nz-icon nzTheme="outline" nzType="edit"></nz-icon>
              </button>
              <button (click)="deleteManager(manager)" nz-button nzDanger nzSize="small" nzType="link">
                <nz-icon nzTheme="outline" nzType="delete"></nz-icon>
              </button>
            </td>

          </tr>
          </tbody>
        </nz-table>
      </nz-spin>
    </div>
  </div>
</div>

<!-- ===== Component: Manager Drawer ===== -->
<nz-drawer
  [nzTitle]="managerDrawerTitle"
  [nzVisible]="isManagerDrawerVisible"
  [nzWidth]="480"
  [nzFooter]="managerDrawerFooter"
  (nzOnClose)="closeManagerDrawer()"
>
  <form *nzDrawerContent [formGroup]="managerForm" class="drawer-form" nz-form>

    <!-- ===== Section: Basic Information ===== -->
    <div class="drawer-section">
      <h3 class="section-title">Informações do Manager</h3>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Nome</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <input formControlName="name" nz-input placeholder="Insira o nome"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Contacto</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <input formControlName="contact" nz-input placeholder="Digite o contacto"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Morada</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <input formControlName="address" nz-input placeholder="Insira a morada"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Status</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <nz-select formControlName="status" nzPlaceHolder="Selecione o status">
            <nz-option nzLabel="Ativo" nzValue="ACTIVO"></nz-option>
            <nz-option nzLabel="Inativo" nzValue="INACTIVO"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>

    <br/>

    <!-- ===== UI: Saving Spinner ===== -->
    <div *ngIf="isSaving" class="drawer-spinner">
      <nz-spin nzSize="large"></nz-spin>
      <br/>
      <p>Saving manager... Please wait.</p>
    </div>

  </form>

  <!-- ===== Drawer Footer ===== -->
  <ng-template #managerDrawerFooter>
    <div class="drawer-footer">
      <button (click)="closeManagerDrawer()" class="btn-cancelar" nz-button nzType="default">Cancel</button>
      <button (click)="submitManager()" [disabled]="!managerForm.valid" class="btn-salvar" nz-button nzType="primary">Save</button>
    </div>
  </ng-template>

</nz-drawer>
