<div class="content-wrapper">

  <!-- ==================== Page Header ==================== -->
  <div class="page-header">
    <p>Lista de Motoristas</p>
  </div>

  <!-- ==================== Summary Cards ==================== -->
  <div class="summary-section">
    <div class="summary-background">
      <div [nzGutter]="8" nz-row>
        <div [nzSpan]="8" nz-col>
          <nz-card nzTitle="Total Motoristas">
            <p>{{ totalDrivers | number }}</p>
          </nz-card>
        </div>
        <div [nzSpan]="8" nz-col>
          <nz-card nzTitle="Motoristas Ativos">
            <p>{{ totalActiveDrivers | number }}</p>
          </nz-card>
        </div>
        <div [nzSpan]="8" nz-col>
          <nz-card nzTitle="Motoristas Inativos">
            <p>{{ totalInactiveDrivers | number }}</p>
          </nz-card>
        </div>
      </div>
    </div>
  </div>

  <!-- ==================== Filters Panel ==================== -->
  <div class="filters-panel">
    <input
      (ngModelChange)="search()"
      [(ngModel)]="searchValue"
      nz-input
      placeholder="Pesquisar..."
      type="text"
    />
    <button (click)="openDriverDrawer()" nz-button nzType="primary">Novo Motorista</button>
  </div>

  <!-- ==================== Drivers Table ==================== -->
  <div class="table-wrapper">
    <div class="table-scroll">
      <nz-spin [nzSpinning]="isLoading" nzSize="large" nzTip="A carregar motoristas...">
        <nz-table
          #nzTable
          [nzData]="listOfDisplayData"
          [nzScroll]="{ x: '800px', y: '300px' }"
          nzTableLayout="fixed"
        >
          <thead>
          <tr>
            <th>Nome</th>
            <th>Telefone</th>
            <th>Descrição do Carro</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
          </thead>

          <tbody>
          <tr *ngFor="let driver of nzTable.data">

            <!-- Inline Editing: Name -->
            <td>
              <ng-container *ngIf="editingDriver?.id === driver.id && editingField === 'Name'; else viewName">
                <input
                  (blur)="saveInlineEdit(driver, 'Name')"
                  (keyup.enter)="saveInlineEdit(driver, 'Name')"
                  [(ngModel)]="editingDriver!.Name"
                  nz-input
                />
              </ng-container>
              <ng-template #viewName>
                <span (click)="startInlineEdit(driver, 'Name')" class="editable-cell">{{ driver.Name }}</span>
              </ng-template>
            </td>

            <!-- Inline Editing: Phone -->
            <td>
              <ng-container *ngIf="editingDriver?.id === driver.id && editingField === 'Phone'; else viewPhone">
                <input
                  (blur)="saveInlineEdit(driver, 'Phone')"
                  (keyup.enter)="saveInlineEdit(driver, 'Phone')"
                  [(ngModel)]="editingDriver!.Phone"
                  nz-input
                />
              </ng-container>
              <ng-template #viewPhone>
                <span (click)="startInlineEdit(driver, 'Phone')" class="editable-cell">{{ driver.Phone }}</span>
              </ng-template>
            </td>

            <!-- Inline Editing: Car Description -->
            <td>
              <ng-container *ngIf="editingDriver?.id === driver.id && editingField === 'CarDescription'; else viewCar">
                <input
                  (blur)="saveInlineEdit(driver, 'CarDescription')"
                  (keyup.enter)="saveInlineEdit(driver, 'CarDescription')"
                  [(ngModel)]="editingDriver!.CarDescription"
                  nz-input
                />
              </ng-container>
              <ng-template #viewCar>
                  <span (click)="startInlineEdit(driver, 'CarDescription')" class="editable-cell">
                    {{ driver.CarDescription }}
                  </span>
              </ng-template>
            </td>

            <!-- Status Dropdown -->
            <td>
              <button [nzDropdownMenu]="menu" nz-button nz-dropdown nzTrigger="click">
                <nz-tag [nzColor]="driver.status === 'ACTIVO' ? 'green' : 'red'">
                  {{ driver.status }}
                </nz-tag>
              </button>
              <nz-dropdown-menu #menu="nzDropdownMenu">
                <ul nz-menu>
                  <li (click)="updateStatus(driver, 'ACTIVO')" nz-menu-item>
                    <span class="status-option status-activo">Activo</span>
                  </li>
                  <li (click)="updateStatus(driver, 'INACTIVO')" nz-menu-item>
                    <span class="status-option status-inactivo">Inactivo</span>
                  </li>
                </ul>
              </nz-dropdown-menu>
            </td>

            <!-- Action Buttons -->
            <td>
              <button (click)="editDriver(driver)" nz-button nzSize="small" nzType="link">
                <nz-icon nzTheme="outline" nzType="edit"></nz-icon>
              </button>
              <button (click)="deleteDriver(driver)" nz-button nzDanger nzSize="small" nzType="link">
                <nz-icon nzTheme="outline" nzType="delete"></nz-icon>
              </button>
            </td>

          </tr>
          </tbody>
        </nz-table>
      </nz-spin>
    </div>
  </div>

</div>

<!-- ==================== Driver Drawer ==================== -->
<nz-drawer
  (nzOnClose)="closeDriverDrawer()"
  [nzFooter]="driverDrawerFooter"
  [nzTitle]="driverDrawerTitle"
  [nzVisible]="isDriverDrawerVisible"
  [nzWidth]="480"
>
  <form *nzDrawerContent [formGroup]="driverForm" class="drawer-form" nz-form>

    <!-- Basic Information Section -->
    <div class="drawer-section">
      <h3 class="section-title">Informações do Motorista</h3>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Nome</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <input formControlName="name" nz-input placeholder="Nome do motorista"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Telefone</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <input formControlName="phone" nz-input placeholder="Número de telefone"/>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Descrição do Carro</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <nz-select formControlName="carDescription" nzPlaceHolder="Selecione a Descrição do carro">
            <nz-option nzLabel="4m3-2KB DYNA" nzValue="4m3-2KB DYNA"></nz-option>
            <nz-option nzLabel="7m3-HINO RANGER" nzValue="7m3-HINO RANGER"></nz-option>
            <nz-option nzLabel="18m3-TATA AMARELO" nzValue="18m3-TATA AMARELO"></nz-option>
            <nz-option nzLabel="20m3-TATA AZUL" nzValue="20m3-TATA AZUL"></nz-option>
            <nz-option nzLabel="22m3-SINOTRUCK" nzValue="22m3-SINOTRUCK"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label [nzSm]="6" [nzXs]="24" nzRequired>Status</nz-form-label>
        <nz-form-control [nzSm]="18" [nzXs]="24">
          <nz-select formControlName="status" nzPlaceHolder="Selecione o status">
            <nz-option nzLabel="ACTIVO" nzValue="ACTIVO"></nz-option>
            <nz-option nzLabel="INACTIVO" nzValue="INACTIVO"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
    </div>

    <!-- Saving Spinner -->
    <div *ngIf="isSaving" class="drawer-spinner">
      <nz-spin nzSize="large"></nz-spin>
      <br/>
      <p>Salvando motorista... Aguarde.</p>
    </div>

  </form>

  <!-- Drawer Footer -->
  <ng-template #driverDrawerFooter>
    <div class="drawer-footer">
      <button (click)="closeDriverDrawer()" class="btn-cancelar" nz-button nzType="default">Cancelar</button>
      <button (click)="submitDriver()" [disabled]="!driverForm.valid" class="btn-salvar" nz-button nzType="primary">
        Salvar
      </button>
    </div>
  </ng-template>
</nz-drawer>
